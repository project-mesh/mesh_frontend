{"remainingRequest":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/babel-loader/lib/index.js!/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/src/store/modules/user.js","dependencies":[{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/src/store/modules/user.js","mtime":1595163695051},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1584708646078},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/babel-loader/lib/index.js","mtime":1585053728484}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgc3RvcmFnZSBmcm9tICdzdG9yZSc7CmltcG9ydCB7IGxvZ2luLCBnZXRJbmZvLCBsb2dvdXQgfSBmcm9tICdAL2FwaS9sb2dpbic7CmltcG9ydCB7IEFDQ0VTU19UT0tFTiB9IGZyb20gJ0Avc3RvcmUvbXV0YXRpb24tdHlwZXMnOwppbXBvcnQgeyB3ZWxjb21lIH0gZnJvbSAnQC91dGlscy91dGlsJzsKdmFyIHVzZXIgPSB7CiAgc3RhdGU6IHsKICAgIHRva2VuOiAnJywKICAgIG5hbWU6ICcnLAogICAgd2VsY29tZTogJycsCiAgICBhdmF0YXI6ICcnLAogICAgcm9sZXM6IFtdLAogICAgaW5mbzoge30KICB9LAogIG11dGF0aW9uczogewogICAgU0VUX1RPS0VOOiBmdW5jdGlvbiBTRVRfVE9LRU4oc3RhdGUsIHRva2VuKSB7CiAgICAgIHN0YXRlLnRva2VuID0gdG9rZW47CiAgICB9LAogICAgU0VUX05BTUU6IGZ1bmN0aW9uIFNFVF9OQU1FKHN0YXRlLCBfcmVmKSB7CiAgICAgIHZhciBuYW1lID0gX3JlZi5uYW1lLAogICAgICAgICAgd2VsY29tZSA9IF9yZWYud2VsY29tZTsKICAgICAgc3RhdGUubmFtZSA9IG5hbWU7CiAgICAgIHN0YXRlLndlbGNvbWUgPSB3ZWxjb21lOwogICAgfSwKICAgIFNFVF9BVkFUQVI6IGZ1bmN0aW9uIFNFVF9BVkFUQVIoc3RhdGUsIGF2YXRhcikgewogICAgICBzdGF0ZS5hdmF0YXIgPSBhdmF0YXI7CiAgICB9LAogICAgU0VUX1JPTEVTOiBmdW5jdGlvbiBTRVRfUk9MRVMoc3RhdGUsIHJvbGVzKSB7CiAgICAgIHN0YXRlLnJvbGVzID0gcm9sZXM7CiAgICB9LAogICAgU0VUX0lORk86IGZ1bmN0aW9uIFNFVF9JTkZPKHN0YXRlLCBpbmZvKSB7CiAgICAgIHN0YXRlLmluZm8gPSBpbmZvOwogICAgfQogIH0sCiAgYWN0aW9uczogewogICAgLy8g55m75b2VCiAgICBMb2dpbjogZnVuY3Rpb24gTG9naW4oX3JlZjIsIHVzZXJJbmZvKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMi5jb21taXQ7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgbG9naW4odXNlckluZm8pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzcG9uc2UucmVzdWx0OwogICAgICAgICAgc3RvcmFnZS5zZXQoQUNDRVNTX1RPS0VOLCByZXN1bHQudG9rZW4sIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKTsKICAgICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgcmVzdWx0LnRva2VuKTsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOiOt+WPlueUqOaIt+S/oeaBrwogICAgR2V0SW5mbzogZnVuY3Rpb24gR2V0SW5mbyhfcmVmMykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGdldEluZm8oKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3BvbnNlLnJlc3VsdDsKCiAgICAgICAgICBpZiAocmVzdWx0LnJvbGUgJiYgcmVzdWx0LnJvbGUucGVybWlzc2lvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgcm9sZSA9IHJlc3VsdC5yb2xlOwogICAgICAgICAgICByb2xlLnBlcm1pc3Npb25zID0gcmVzdWx0LnJvbGUucGVybWlzc2lvbnM7CiAgICAgICAgICAgIHJvbGUucGVybWlzc2lvbnMubWFwKGZ1bmN0aW9uIChwZXIpIHsKICAgICAgICAgICAgICBpZiAocGVyLmFjdGlvbkVudGl0eVNldCAhPSBudWxsICYmIHBlci5hY3Rpb25FbnRpdHlTZXQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IHBlci5hY3Rpb25FbnRpdHlTZXQubWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5hY3Rpb247CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHBlci5hY3Rpb25MaXN0ID0gYWN0aW9uOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJvbGUucGVybWlzc2lvbkxpc3QgPSByb2xlLnBlcm1pc3Npb25zLm1hcChmdW5jdGlvbiAocGVybWlzc2lvbikgewogICAgICAgICAgICAgIHJldHVybiBwZXJtaXNzaW9uLnBlcm1pc3Npb25JZDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbW1pdCgnU0VUX1JPTEVTJywgcmVzdWx0LnJvbGUpOwogICAgICAgICAgICBjb21taXQoJ1NFVF9JTkZPJywgcmVzdWx0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ2dldEluZm86IHJvbGVzIG11c3QgYmUgYSBub24tbnVsbCBhcnJheSAhJykpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbW1pdCgnU0VUX05BTUUnLCB7CiAgICAgICAgICAgIG5hbWU6IHJlc3VsdC5uYW1lLAogICAgICAgICAgICB3ZWxjb21lOiB3ZWxjb21lKCkKICAgICAgICAgIH0pOwogICAgICAgICAgY29tbWl0KCdTRVRfQVZBVEFSJywgcmVzdWx0LmF2YXRhcik7CiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTsKICAgICAgICB9KVsiY2F0Y2giXShmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8vIOeZu+WHugogICAgTG9nb3V0OiBmdW5jdGlvbiBMb2dvdXQoX3JlZjQpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWY0LmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjQuc3RhdGU7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIGxvZ291dChzdGF0ZS50b2tlbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSlbImNhdGNoIl0oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pWyJmaW5hbGx5Il0oZnVuY3Rpb24gKCkgewogICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCAnJyk7CiAgICAgICAgICBjb21taXQoJ1NFVF9ST0xFUycsIFtdKTsKICAgICAgICAgIHN0b3JhZ2UucmVtb3ZlKEFDQ0VTU19UT0tFTik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTsKZXhwb3J0IGRlZmF1bHQgdXNlcjs="},{"version":3,"sources":["/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/src/store/modules/user.js"],"names":["storage","login","getInfo","logout","ACCESS_TOKEN","welcome","user","state","token","name","avatar","roles","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_INFO","actions","Login","userInfo","commit","Promise","resolve","reject","then","response","result","set","error","GetInfo","role","permissions","length","map","per","actionEntitySet","action","actionList","permissionList","permission","permissionId","Error","Logout","remove"],"mappings":"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","sourcesContent":["import storage from 'store'\nimport { login, getInfo, logout } from '@/api/login'\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\nimport { welcome } from '@/utils/util'\n\nconst user = {\n  state: {\n    token: '',\n    name: '',\n    welcome: '',\n    avatar: '',\n    roles: [],\n    info: {}\n  },\n\n  mutations: {\n    SET_TOKEN: (state, token) => {\n      state.token = token\n    },\n    SET_NAME: (state, { name, welcome }) => {\n      state.name = name\n      state.welcome = welcome\n    },\n    SET_AVATAR: (state, avatar) => {\n      state.avatar = avatar\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles\n    },\n    SET_INFO: (state, info) => {\n      state.info = info\n    }\n  },\n\n  actions: {\n    // 登录\n    Login ({ commit }, userInfo) {\n      return new Promise((resolve, reject) => {\n        login(userInfo).then(response => {\n          const result = response.result\n          storage.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000)\n          commit('SET_TOKEN', result.token)\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 获取用户信息\n    GetInfo ({ commit }) {\n      return new Promise((resolve, reject) => {\n        getInfo().then(response => {\n          const result = response.result\n\n          if (result.role && result.role.permissions.length > 0) {\n            const role = result.role\n            role.permissions = result.role.permissions\n            role.permissions.map(per => {\n              if (per.actionEntitySet != null && per.actionEntitySet.length > 0) {\n                const action = per.actionEntitySet.map(action => { return action.action })\n                per.actionList = action\n              }\n            })\n            role.permissionList = role.permissions.map(permission => { return permission.permissionId })\n            commit('SET_ROLES', result.role)\n            commit('SET_INFO', result)\n          } else {\n            reject(new Error('getInfo: roles must be a non-null array !'))\n          }\n\n          commit('SET_NAME', { name: result.name, welcome: welcome() })\n          commit('SET_AVATAR', result.avatar)\n\n          resolve(response)\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 登出\n    Logout ({ commit, state }) {\n      return new Promise((resolve) => {\n        logout(state.token).then(() => {\n          resolve()\n        }).catch(() => {\n          resolve()\n        }).finally(() => {\n          commit('SET_TOKEN', '')\n          commit('SET_ROLES', [])\n          storage.remove(ACCESS_TOKEN)\n        })\n      })\n    }\n\n  }\n}\n\nexport default user\n"]}]}