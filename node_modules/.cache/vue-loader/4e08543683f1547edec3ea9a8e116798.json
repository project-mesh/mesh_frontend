{"remainingRequest":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/src/views/form/advancedForm/AdvancedForm.vue?vue&type=style&index=0&id=7035909e&lang=less&scoped=true&","dependencies":[{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/src/views/form/advancedForm/AdvancedForm.vue","mtime":1595163695055},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/css-loader/dist/cjs.js","mtime":1595163801589},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1595163801714},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/postcss-loader/src/index.js","mtime":1584708863364},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/less-loader/dist/cjs.js","mtime":1595163803276},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1584708646078},{"path":"/Users/xuedixuedi/lxdThings/Code/github/mesh-frontend/node_modules/vue-loader/lib/index.js","mtime":1595163801714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5jYXJkewogIG1hcmdpbi1ib3R0b206IDI0cHg7Cn0KLnBvcG92ZXItd3JhcHBlciB7CiAgL2RlZXAvIC5hbnRkLXByby1wYWdlcy1mb3Jtcy1zdHlsZS1lcnJvclBvcG92ZXIgLmFudC1wb3BvdmVyLWlubmVyLWNvbnRlbnQgewogICAgbWluLXdpZHRoOiAyNTZweDsKICAgIG1heC1oZWlnaHQ6IDI5MHB4OwogICAgcGFkZGluZzogMDsKICAgIG92ZXJmbG93OiBhdXRvOwogIH0KfQouYW50ZC1wcm8tcGFnZXMtZm9ybXMtc3R5bGUtZXJyb3JJY29uIHsKICB1c2VyLXNlbGVjdDogbm9uZTsKICBtYXJnaW4tcmlnaHQ6IDI0cHg7CiAgY29sb3I6ICNmNTIyMmQ7CiAgY3Vyc29yOiBwb2ludGVyOwogIGkgewogICAgICAgIG1hcmdpbi1yaWdodDogNHB4OwogIH0KfQouYW50ZC1wcm8tcGFnZXMtZm9ybXMtc3R5bGUtZXJyb3JMaXN0SXRlbSB7CiAgcGFkZGluZzogOHB4IDE2cHg7CiAgbGlzdC1zdHlsZTogbm9uZTsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2U4ZThlODsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYWxsIC4zczsKCiAgJjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kOiAjZTZmN2ZmOwogIH0KICAuYW50ZC1wcm8tcGFnZXMtZm9ybXMtc3R5bGUtZXJyb3JJY29uIHsKICAgIGZsb2F0OiBsZWZ0OwogICAgbWFyZ2luLXRvcDogNHB4OwogICAgbWFyZ2luLXJpZ2h0OiAxMnB4OwogICAgcGFkZGluZy1ib3R0b206IDIycHg7CiAgICBjb2xvcjogI2Y1MjIyZDsKICB9CiAgLmFudGQtcHJvLXBhZ2VzLWZvcm1zLXN0eWxlLWVycm9yRmllbGQgewogICAgbWFyZ2luLXRvcDogMnB4OwogICAgY29sb3I6IHJnYmEoMCwwLDAsLjQ1KTsKICAgIGZvbnQtc2l6ZTogMTJweDsKICB9Cn0K"},{"version":3,"sources":["AdvancedForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AdvancedForm.vue","sourceRoot":"src/views/form/advancedForm","sourcesContent":["<template>\n  <page-header-wrapper content=\"高级表单常见于一次性输入和提交大批量数据的场景\">\n    <a-card class=\"card\" title=\"仓库管理\" :bordered=\"false\">\n      <repository-form ref=\"repository\" :showSubmit=\"false\" />\n    </a-card>\n    <a-card class=\"card\" title=\"任务管理\" :bordered=\"false\">\n      <task-form ref=\"task\" :showSubmit=\"false\" />\n    </a-card>\n\n    <!-- table -->\n    <a-card>\n      <a-table\n        :columns=\"columns\"\n        :dataSource=\"data\"\n        :pagination=\"false\"\n        :loading=\"memberLoading\"\n      >\n        <template v-for=\"(col, i) in ['name', 'workId', 'department']\" :slot=\"col\" slot-scope=\"text, record\">\n          <a-input\n            :key=\"col\"\n            v-if=\"record.editable\"\n            style=\"margin: -5px 0\"\n            :value=\"text\"\n            :placeholder=\"columns[i].title\"\n            @change=\"e => handleChange(e.target.value, record.key, col)\"\n          />\n          <template v-else>{{ text }}</template>\n        </template>\n        <template slot=\"operation\" slot-scope=\"text, record\">\n          <template v-if=\"record.editable\">\n            <span v-if=\"record.isNew\">\n              <a @click=\"saveRow(record)\">添加</a>\n              <a-divider type=\"vertical\" />\n              <a-popconfirm title=\"是否要删除此行？\" @confirm=\"remove(record.key)\">\n                <a>删除</a>\n              </a-popconfirm>\n            </span>\n            <span v-else>\n              <a @click=\"saveRow(record)\">保存</a>\n              <a-divider type=\"vertical\" />\n              <a @click=\"cancel(record.key)\">取消</a>\n            </span>\n          </template>\n          <span v-else>\n            <a @click=\"toggle(record.key)\">编辑</a>\n            <a-divider type=\"vertical\" />\n            <a-popconfirm title=\"是否要删除此行？\" @confirm=\"remove(record.key)\">\n              <a>删除</a>\n            </a-popconfirm>\n          </span>\n        </template>\n      </a-table>\n      <a-button style=\"width: 100%; margin-top: 16px; margin-bottom: 8px\" type=\"dashed\" icon=\"plus\" @click=\"newMember\">新增成员</a-button>\n    </a-card>\n\n    <!-- fixed footer toolbar -->\n    <footer-tool-bar :is-mobile=\"isMobile\" :collapsed=\"sideCollapsed\">\n      <span class=\"popover-wrapper\">\n        <a-popover title=\"表单校验信息\" overlayClassName=\"antd-pro-pages-forms-style-errorPopover\" trigger=\"click\" :getPopupContainer=\"trigger => trigger.parentNode\">\n          <template slot=\"content\">\n            <li v-for=\"item in errors\" :key=\"item.key\" @click=\"scrollToField(item.key)\" class=\"antd-pro-pages-forms-style-errorListItem\">\n              <a-icon type=\"cross-circle-o\" class=\"antd-pro-pages-forms-style-errorIcon\" />\n              <div class=\"\">{{ item.message }}</div>\n              <div class=\"antd-pro-pages-forms-style-errorField\">{{ item.fieldLabel }}</div>\n            </li>\n          </template>\n          <span class=\"antd-pro-pages-forms-style-errorIcon\" v-if=\"errors.length > 0\">\n            <a-icon type=\"exclamation-circle\" />{{ errors.length }}\n          </span>\n        </a-popover>\n      </span>\n      <a-button type=\"primary\" @click=\"validate\" :loading=\"loading\">提交</a-button>\n    </footer-tool-bar>\n  </page-header-wrapper>\n</template>\n\n<script>\nimport RepositoryForm from './RepositoryForm'\nimport TaskForm from './TaskForm'\nimport FooterToolBar from '@/components/FooterToolbar'\nimport { baseMixin } from '@/store/app-mixin'\n\nconst fieldLabels = {\n  name: '仓库名',\n  url: '仓库域名',\n  owner: '仓库管理员',\n  approver: '审批人',\n  dateRange: '生效日期',\n  type: '仓库类型',\n  name2: '任务名',\n  url2: '任务描述',\n  owner2: '执行人',\n  approver2: '责任人',\n  dateRange2: '生效日期',\n  type2: '任务类型'\n}\n\nexport default {\n  name: 'AdvancedForm',\n  mixins: [baseMixin],\n  components: {\n    FooterToolBar,\n    RepositoryForm,\n    TaskForm\n  },\n  data () {\n    return {\n      loading: false,\n      memberLoading: false,\n\n      // table\n      columns: [\n        {\n          title: '成员姓名',\n          dataIndex: 'name',\n          key: 'name',\n          width: '20%',\n          scopedSlots: { customRender: 'name' }\n        },\n        {\n          title: '工号',\n          dataIndex: 'workId',\n          key: 'workId',\n          width: '20%',\n          scopedSlots: { customRender: 'workId' }\n        },\n        {\n          title: '所属部门',\n          dataIndex: 'department',\n          key: 'department',\n          width: '40%',\n          scopedSlots: { customRender: 'department' }\n        },\n        {\n          title: '操作',\n          key: 'action',\n          scopedSlots: { customRender: 'operation' }\n        }\n      ],\n      data: [\n        {\n          key: '1',\n          name: '小明',\n          workId: '001',\n          editable: false,\n          department: '行政部'\n        },\n        {\n          key: '2',\n          name: '李莉',\n          workId: '002',\n          editable: false,\n          department: 'IT部'\n        },\n        {\n          key: '3',\n          name: '王小帅',\n          workId: '003',\n          editable: false,\n          department: '财务部'\n        }\n      ],\n\n      errors: []\n    }\n  },\n  methods: {\n    handleSubmit (e) {\n      e.preventDefault()\n    },\n    newMember () {\n      const length = this.data.length\n      this.data.push({\n        key: length === 0 ? '1' : (parseInt(this.data[length - 1].key) + 1).toString(),\n        name: '',\n        workId: '',\n        department: '',\n        editable: true,\n        isNew: true\n      })\n    },\n    remove (key) {\n      const newData = this.data.filter(item => item.key !== key)\n      this.data = newData\n    },\n    saveRow (record) {\n      this.memberLoading = true\n      const { key, name, workId, department } = record\n      if (!name || !workId || !department) {\n        this.memberLoading = false\n        this.$message.error('请填写完整成员信息。')\n        return\n      }\n      // 模拟网络请求、卡顿 800ms\n      new Promise((resolve) => {\n        setTimeout(() => {\n          resolve({ loop: false })\n        }, 800)\n      }).then(() => {\n        const target = this.data.find(item => item.key === key)\n        target.editable = false\n        target.isNew = false\n        this.memberLoading = false\n      })\n    },\n    toggle (key) {\n      const target = this.data.find(item => item.key === key)\n      target._originalData = { ...target }\n      target.editable = !target.editable\n    },\n    getRowByKey (key, newData) {\n      const data = this.data\n      return (newData || data).find(item => item.key === key)\n    },\n    cancel (key) {\n      const target = this.data.find(item => item.key === key)\n      Object.keys(target).forEach(key => { target[key] = target._originalData[key] })\n      target._originalData = undefined\n    },\n    handleChange (value, key, column) {\n      const newData = [...this.data]\n      const target = newData.find(item => key === item.key)\n      if (target) {\n        target[column] = value\n        this.data = newData\n      }\n    },\n\n    // 最终全页面提交\n    validate () {\n      const { $refs: { repository, task }, $notification } = this\n      const repositoryForm = new Promise((resolve, reject) => {\n        repository.form.validateFields((err, values) => {\n          if (err) {\n            reject(err)\n            return\n          }\n          resolve(values)\n        })\n      })\n      const taskForm = new Promise((resolve, reject) => {\n        task.form.validateFields((err, values) => {\n          if (err) {\n            reject(err)\n            return\n          }\n          resolve(values)\n        })\n      })\n\n      // clean this.errors\n      this.errors = []\n      Promise.all([repositoryForm, taskForm]).then(values => {\n        $notification['error']({\n          message: 'Received values of form:',\n          description: JSON.stringify(values)\n        })\n      }).catch(() => {\n        const errors = Object.assign({}, repository.form.getFieldsError(), task.form.getFieldsError())\n        const tmp = { ...errors }\n        this.errorList(tmp)\n      })\n    },\n    errorList (errors) {\n      if (!errors || errors.length === 0) {\n        return\n      }\n      this.errors = Object.keys(errors)\n        .filter(key => errors[key])\n        .map(key => ({\n          key: key,\n          message: errors[key][0],\n          fieldLabel: fieldLabels[key]\n        }))\n    },\n    scrollToField (fieldKey) {\n      const labelNode = document.querySelector(`label[for=\"${fieldKey}\"]`)\n      if (labelNode) {\n        labelNode.scrollIntoView(true)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n  .card{\n    margin-bottom: 24px;\n  }\n  .popover-wrapper {\n    /deep/ .antd-pro-pages-forms-style-errorPopover .ant-popover-inner-content {\n      min-width: 256px;\n      max-height: 290px;\n      padding: 0;\n      overflow: auto;\n    }\n  }\n  .antd-pro-pages-forms-style-errorIcon {\n    user-select: none;\n    margin-right: 24px;\n    color: #f5222d;\n    cursor: pointer;\n    i {\n          margin-right: 4px;\n    }\n  }\n  .antd-pro-pages-forms-style-errorListItem {\n    padding: 8px 16px;\n    list-style: none;\n    border-bottom: 1px solid #e8e8e8;\n    cursor: pointer;\n    transition: all .3s;\n\n    &:hover {\n      background: #e6f7ff;\n    }\n    .antd-pro-pages-forms-style-errorIcon {\n      float: left;\n      margin-top: 4px;\n      margin-right: 12px;\n      padding-bottom: 22px;\n      color: #f5222d;\n    }\n    .antd-pro-pages-forms-style-errorField {\n      margin-top: 2px;\n      color: rgba(0,0,0,.45);\n      font-size: 12px;\n    }\n  }\n</style>\n"]}]}